<!-- Sliding Cart Snippet -->
<div class="sliding-cart-container">
  <!-- El JavaScript creará automáticamente la estructura del carrito -->
</div>

<!-- Botón de carrito personalizado -->
<style>
.custom-cart-button {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  background: none;
  border: none;
  cursor: pointer;
  color: inherit;
  text-decoration: none;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.custom-cart-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.custom-cart-button svg {
  width: 24px;
  height: 24px;
  fill: currentColor;
}

.custom-cart-count {
  position: absolute;
  top: -5px;
  right: -5px;
  min-width: 20px;
  height: 20px;
  padding: 0 5px;
  background: #333;
  color: white;
  border-radius: 10px;
  font-size: 12px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: sans-serif;
}

.custom-cart-count.hidden {
  display: none;
}
</style>

<!-- Scripts del carrito deslizante -->
<script>
  // Configuración global
  window.SlidingCartConfig = {
    // Configuración General
    enabled: {{ settings.enable_sliding_cart | default: true }},
    position: '{{ settings.cart_position | default: "right" }}',
    width: {{ settings.cart_width | default: 450 }},
    
    // Comportamiento del Carrito
    autoCloseDelay: {{ settings.cart_auto_close_delay | default: 8000 }},
    autoCloseEnabled: {{ settings.cart_auto_close_delay | default: 8000 }} > 0,
    showCartCount: {{ settings.show_cart_count | default: true }},
    showCartTotal: {{ settings.show_cart_total | default: true }},
    
    // Sistema de Recomendaciones
    showRecommendations: {{ settings.show_cart_recommendations | default: true }},
    recommendationsLimit: {{ settings.cart_recommendations_limit | default: 6 }},
    recommendationsSource: '{{ settings.recommendations_source | default: "hybrid" }}',
    showRecommendationsTitle: {{ settings.show_recommendations_title | default: true }},
    recommendationsTitle: '{{ settings.recommendations_title | default: "También te puede interesar" }}',
    
    // Configuración Visual
    cartBackgroundColor: '{{ settings.cart_background_color | default: "#000000" }}',
    cartTextColor: '{{ settings.cart_text_color | default: "#ffffff" }}',
    cartAccentColor: '{{ settings.cart_accent_color | default: "#ff6b6b" }}',
    showProductImages: {{ settings.show_product_images | default: true }},
    showVariantTitles: {{ settings.show_variant_titles | default: true }},
    
    // Configuración Avanzada
    enableQuantityControls: {{ settings.enable_quantity_controls | default: true }},
    enableRemoveButtons: {{ settings.enable_remove_buttons | default: true }},
    showToastNotifications: {{ settings.show_toast_notifications | default: true }},
    toastDuration: {{ settings.toast_duration | default: 3000 }},
    
    // Configuración del Sistema
    currency: '{{ shop.currency }}',
    moneyFormat: '{{ shop.money_format }}',
    cartUrl: '{{ routes.cart_url }}',
    checkoutUrl: '{{ routes.root_url }}checkout'
  };

  // Datos del producto actual para recomendaciones
  {% if product %}
  window.currentProduct = {
    id: {{ product.id }},
    handle: '{{ product.handle }}',
    vendor: '{{ product.vendor }}',
    tags: [{% for tag in product.tags %}'{{ tag }}'{% unless forloop.last %},{% endunless %}{% endfor %}],
    {% if product.metafields.shopify__discovery__product_recommendation.related_products %}
    manualRecommendations: [{{ product.metafields.shopify__discovery__product_recommendation.related_products }}]
    {% endif %}
  };
  {% endif %}

  // Función para crear botón de carrito personalizado
  function createCustomCartButton() {
    const cartButtonHTML = `
      <button class="custom-cart-button" id="custom-cart-button" aria-label="Ver carrito">
        <svg viewBox="0 0 24 24">
          <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
        </svg>
        <span class="custom-cart-count hidden" id="custom-cart-count">0</span>
      </button>
    `;

    // Buscar el botón del carrito del tema y reemplazarlo
    const themeCartButton = document.querySelector('.header__icon--cart, [data-cart-icon], .cart-icon');
    if (themeCartButton) {
      themeCartButton.outerHTML = cartButtonHTML;
    } else {
      // Si no encuentra el botón del tema, crear uno en el header
      const header = document.querySelector('header, .header');
      if (header) {
        const headerIcons = header.querySelector('.header__icons, .header-icons');
        if (headerIcons) {
          headerIcons.insertAdjacentHTML('beforeend', cartButtonHTML);
        }
      }
    }

    // Añadir event listener al botón personalizado
    const customButton = document.getElementById('custom-cart-button');
    if (customButton) {
      customButton.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (window.slidingCart) {
          window.slidingCart.showCart();
        }
      });
    }
  }

  // Crear el botón cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', createCustomCartButton);
  } else {
    createCustomCartButton();
  }
</script>

{{ 'sliding-cart.css' | asset_url | stylesheet_tag }}
<script src="{{ 'sliding-cart.js' | asset_url }}" defer></script>